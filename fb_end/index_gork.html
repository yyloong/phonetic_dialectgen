<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ğŸ—£ï¸ TTS Demo</title>
</head>
<body>
    <h1>ğŸ—£ï¸ TTS Demo</h1>
    <input type="text" id="inputText" placeholder="è¯·è¾“å…¥è¦è½¬æ¢çš„æ–‡æœ¬">
    <br><br>
    <input type="radio" id="mandarin" name="language" value="mandarin" checked>
    <label for="mandarin">æ™®é€šè¯</label>
    <input type="radio" id="cantonese" name="language" value="cantonese">
    <label for="cantonese">ç²¤è¯­</label>
    <br><br>
    <button onclick="generateTTS()">ç”Ÿæˆè¯­éŸ³</button>
    <script>
        async function generateTTS() {
            const inputText = document.getElementById('inputText').value.trim();
            const language = document.querySelector('input[name="language"]:checked').value;
            const apiKey = 'sk-TUSfPkH2BvShYbh8JXnrFGaRqsUreuM24BY6knI8lemI6ezV'; // æ›¿æ¢ä¸º /home/u-shigc/LLM/2025.07.09_config.toml ä¸­çš„ api_key
            const baseUrl = 'https://api.moonshot.cn/v1'; // æ›¿æ¢ä¸º /home/u-shigc/LLM/2025.07.09_config.toml ä¸­çš„ base_url

            if (!inputText) {
                alert('è¯·è¾“å…¥æ–‡æœ¬ï¼');
                return;
            }

            try {
                // è°ƒç”¨ Moonshot API è¿›è¡Œæ–‡æœ¬è§„èŒƒåŒ–
                const aiResponse = await fetch(`${baseUrl}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'moonshot-v1-128k',
                        messages: [
                            {
                                role: 'system',
                                content: 'å°†è¾“å…¥çš„ä¸­æ–‡å¥å­è¿›è¡Œæ±‰è¯­TTSçš„text normalizationï¼ˆè¿›è¡Œæ±‰è¯­ä¸­æ•°å­—ä¸æ•°é‡è¡¨è¾¾çš„è§„èŒƒåŒ–ï¼›æ•°å­¦ã€ç‰©ç†ç­‰ç¬¦å·çš„å£è¯­åŒ–è½¬æ¢ï¼›å°†æ‰€æœ‰éä¸­æ–‡æ–‡æœ¬ç›´æ¥è¿›è¡Œæ±‰è¯­éŸ³è¯‘ï¼ˆç¦æ­¢ç¿»è¯‘ï¼‰ï¼Œä½¿å¾—è½¬æ¢åçš„å¥å­ä¸­ä»…åŒ…å«ä¸­æ–‡ï¼›æœ€åè¿”å›è½¬æ¢åçš„å¥å­ã€‚æ³¨æ„ï¼šè¾“å‡ºçš„ç»“æœä¸­ä¸èƒ½å‡ºç°è‹±æ–‡æˆ–é˜¿æ‹‰ä¼¯æ•°å­—ï¼ä¸è¦è¾“å‡ºä»»ä½•çš„é¢å¤–ä¿¡æ¯ï¼'
                            },
                            { role: 'user', content: inputText }
                        ],
                        temperature: 0.3
                    })
                });
                if (!aiResponse.ok) {
                    throw new Error('æ–‡æœ¬é¢„å¤„ç†å¤±è´¥');
                }
                const aiData = await aiResponse.json();
                const normalizedText = aiData.choices[0].message.content;

                // å‘é€åˆ°åç«¯ TTS ç«¯ç‚¹
                const ttsResponse = await fetch('http://114.212.87.202:5000/api/tts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: normalizedText, language: language })
                });
                if (!ttsResponse.ok) {
                    throw new Error('è¯­éŸ³ç”Ÿæˆå¤±è´¥');
                }
                const ttsData = await ttsResponse.json();
                if (ttsData.audio_url) {
                    window.location.href = ttsData.audio_url; // å‡è®¾åç«¯è¿”å›éŸ³é¢‘ URL å¹¶è·³è½¬æ’­æ”¾
                } else {
                    alert('è¯­éŸ³ç”ŸæˆæˆåŠŸï¼Œä½†æœªè¿”å›éŸ³é¢‘URLï¼');
                }
            } catch (error) {
                alert('é”™è¯¯ï¼š' + error.message);
            }
        }
    </script>
</body>
</html>